/**
*   @file    
*   @brief   
*   @details 
*/
/*==================================================================================================
*                                        INCLUDE FILES
==================================================================================================*/
#include "LPIT_Registers.h"
#include "nvic.h"
#include "Gpio.h"
#include "PORT_Register.h"
/*==================================================================================================
*                          LOCAL TYPEDEFS (STRUCTURES, UNIONS, ENUMS)
==================================================================================================*/

/*==================================================================================================
*                                       LOCAL MACROS
==================================================================================================*/
#define PCC_LPIT            *(unsigned int*)(0X40065000u + 0xDC)
#define PCC_PORTD           *(unsigned int*)(0x40065000u + 0x130)
#define CLK_Source           128000u

/*==================================================================================================
*                                      LOCAL CONSTANTS
==================================================================================================*/

/*==================================================================================================
*                                      LOCAL VARIABLES
==================================================================================================*/

/*==================================================================================================
*                                      GLOBAL CONSTANTS
==================================================================================================*/

/*==================================================================================================
*                                      GLOBAL VARIABLES
==================================================================================================*/
unsigned int seconds = 0, minutes = 0, hours = 0;
/*==================================================================================================
*                                   LOCAL FUNCTION PROTOTYPES
==================================================================================================*/
void LPIT_init ();
void update_time();
/*==================================================================================================
*                                       LOCAL FUNCTIONS
==================================================================================================*/
/**
*   @file    
*   @brief   
*   @details 
*/
void update_time() {
    seconds++;
    if (seconds >= 60) {
        seconds = 0;
        minutes++;
        if (minutes >= 60) {
            minutes = 0;
            hours++;
            if (hours >= 24) {
                hours = 0;
            }
        }
    }
}
/**
*   @file    
*   @brief   
*   @details 
*/
void LPIT_init() {
    PCC_LPIT = 0xC7000000;           /* Enable clock for LPIT
                                         Clock Src = 7: LPO128_CLK        */
    LPIT->MCR = 0x00000009;          /* DBG_EN = 1: Run in Debug mode
                                         M_CEN = 1: Module Clock Enable   */
    LPIT->MIER = 0x00000008;         /* TIE2 = 1: Enable Channel 2 Timer Interrupt */
    LPIT->TVAL3 = CLK_Source - 1;    /* Set Timer value */
    LPIT->TCTRL3 = 0x00000001;       /* MODE = 00: 32-bit Periodic Counter
                                         T_EN = 1: Enable Timer Channel 2 */
}

void LPIT_init () {
	 PCC_LPIT = 0x47000000;           /*  Enable clock for LPIT
	                                      Clock Src = 7: LPO128_CLK        */
	 LPIT->MCR = 0x00000009;         /*   DBG_EN = 1: Run in Debug mode
                                        M_CEN = 1: Module Clock Enable	 */
	 LPIT->TCTRL0 = 0x00000001;      /*   MODE = 00: 32-bit Periodic Counter 
	                                      T_EN = 1: Enable Timer Channel   */ 
 }
/*==================================================================================================
*                                       GLOBAL FUNCTIONS
==================================================================================================*/
/**
* @brief          
* @details        
*
* @param[in]      
*                             
*
* @return         void
*
*
* @pre            
* @post           
*
* @api
*
*/
int main() {
    NVIC_EnableInterrupt(LPIT0_Ch3_IRQn); // Enable NVIC interrupt for LPIT Channel 2
    LPIT_init();
    while (1) {
        // Main loop can be used for other tasks if necessary
    }
}
void LPIT0_Ch3_IRQHandler(void) {
    LPIT->MSR = 0x00000008; // Clear interrupt flag
    update_time();
}