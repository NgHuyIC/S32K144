/**
 * @file    bai3_MaxRun_mode.c
 * @brief   Main function for clock configuration in Normal Run mode
 * @details This file contains the function to configure the system clock to 80 MHz using the System PLL (SPLL).
 */

/*==================================================================================================
 *                                        INCLUDE FILES
==================================================================================================*/
#include "SCG_Registers.h"
#include "Clock.h"

/*==================================================================================================
 *                          LOCAL TYPEDEFS (STRUCTURES, UNIONS, ENUMS)
==================================================================================================*/

/*==================================================================================================
 *                                       LOCAL MACROS
==================================================================================================*/

/*==================================================================================================
 *                                      LOCAL CONSTANTS
==================================================================================================*/

/*==================================================================================================
 *                                      LOCAL VARIABLES
==================================================================================================*/

/*==================================================================================================
 *                                      GLOBAL CONSTANTS
==================================================================================================*/

/*==================================================================================================
 *                                      GLOBAL VARIABLES
==================================================================================================*/

/*==================================================================================================
 *                                   LOCAL FUNCTION PROTOTYPES
==================================================================================================*/

/*==================================================================================================
 *                                       LOCAL FUNCTIONS
==================================================================================================*/

/*==================================================================================================
 *                                       GLOBAL FUNCTIONS
==================================================================================================*/
/**
 * @brief   Configures the system clock to 80 MHz in Normal Run mode.
 * @details This function initializes the System PLL to 160 MHz using the `SPLL_init_160Mhz()` function.
 *          It then configures the SCG to use the system PLL as the clock source and sets the core, bus,
 *          and slow clock dividers to achieve an 80 MHz system clock.
 *
 * @return  void
 */
void NormaRUNmode_80MHz(void)
{
    /* Initialize the System PLL to 160 MHz */
    SPLL_init_160Mhz();

    /* Configure the SCG to use the system PLL and set clock dividers */
    SCG->RCCR = 0x06010012;
    /*
     * SCS = 0110: System PLL (SPLL_CLK) is the system clock source
     * DIVCORE = 0001: Divide core clock by 2
     * DIVBUS = 0001: Divide bus clock by 2
     * DIVSLOW = 0010: Divide slow clock by 3
     */

    /* Wait for the system clock source to be set to SPLL */
    while (((SCG->CSR & SCG_CSR_SCS_MASK) >> SCG_CSR_SCS_SHIFT) != 6)
    {
        /* Do nothing, just wait */
    }
}
